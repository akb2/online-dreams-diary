<div class="area">
  <!-- Область просмотра -->
  <div class="area__viewer"
       (mousedown)="onMouseDown($event)">
    <app-dream-map-viewer [dreamMap]="dreamMap"
                          [debugInfo]="debugInfo"
                          (objectHover)="onObjectHover($event)"></app-dream-map-viewer>
  </div>
  <!-- Область инструментов -->
  <div class="area__control"
       *ngIf="form">
    <!-- Инструмент -->
    <div class="tool-button">
      <mat-icon>{{getCurrentTool.icon}}</mat-icon>
      <!-- Список инструментов -->
      <div class="tool-button__items border-radius">
        <div class="tool-button"
             [ngClass]="{ active: tool.type === getCurrentTool.type }"
             matTooltip="Инструмент: {{tool.name}}"
             (click)="onToolChange(tool.type)"
             *ngFor="let tool of toolList">
          <mat-icon>{{tool.icon}}</mat-icon>
        </div>
      </div>
    </div>
    <!-- Под-инструмент: окружение -->
    <ng-container [ngTemplateOutlet]="envTools"
                  *ngIf="getCurrentTool.type === toolType.sky"></ng-container>
    <!-- Под-инструмент: ландшафт -->
    <ng-container [ngTemplateOutlet]="landscapeTools"
                  *ngIf="getCurrentTool.type === toolType.landscape"></ng-container>
    <!-- Под-инструмент: тип местности -->
    <ng-container [ngTemplateOutlet]="terrainTools"
                  *ngIf="getCurrentTool.type === toolType.terrain"></ng-container>
    <!-- Под-инструмент: вода -->
    <ng-container [ngTemplateOutlet]="waterTools"
                  *ngIf="getCurrentTool.type === toolType.water"></ng-container>
    <!-- Под-инструмент: дорога -->
    <ng-container [ngTemplateOutlet]="roadTools"
                  *ngIf="getCurrentTool.type === toolType.road"></ng-container>
  </div>
</div>





<!-- Под-инструмент: окружение -->
<ng-template #envTools>
  <!-- Положение небесного светила -->
  <form class="tool-button"
        [formGroup]="form">
    <div class="tool-button__point progress">
      <div class="tool-button__point progress__height back">{{timeFormat()}}</div>
      <div class="tool-button__point progress__height fill"
           [ngStyle]="{ height: timeFormat(true) + '%' }">
        <span>{{timeFormat()}}</span>
      </div>
    </div>
    <!-- Настройка размера -->
    <div class="tool-button__items">
      <div class="tool-button container">Время:</div>
      <div class="tool-button container">
        <mat-slider class="long-slider"
                    thumbLabel
                    formControlName="currentTime"
                    [thumbLabel]="false"
                    tickInterval="1000"
                    color="primary"
                    [step]="timeSettings.step"
                    [min]="timeSettings.min"
                    [max]="timeSettings.max"
                    aria-label="blocks"
                    (input)="onTimeChange($event)"
                    (change)="onTimeChange($event)"></mat-slider>
      </div>
    </div>
  </form>
</ng-template>

<!-- Под-инструмент: ландшафт -->
<ng-template #landscapeTools>
  <!-- Направление изменения -->
  <div class="tool-button">
    <mat-icon>{{getCurrentLandscapeTool.icon}}</mat-icon>
    <!-- Список инструментов -->
    <div class="tool-button__items border-radius">
      <div class="tool-button"
           [ngClass]="{ active: tool.type === getCurrentLandscapeTool.type }"
           matTooltip="Ландшафт: {{tool.name}}"
           (click)="onLandscapeToolChange(tool.type)"
           *ngFor="let tool of landscapeToolList">
        <mat-icon>{{tool.icon}}</mat-icon>
      </div>
    </div>
  </div>
  <!-- Размер кисти -->
  <ng-container [ngTemplateOutlet]="toolsSizeForm"></ng-container>
  <!-- Высота окружающего ландшафта -->
  <form class="tool-button"
        [formGroup]="form">
    <div class="tool-button__point progress">
      <div class="tool-button__point progress__height back">{{landHeightFormat}}%</div>
      <div class="tool-button__point progress__height fill"
           [ngStyle]="{ height: landHeightFormat + '%' }">
        <span>{{landHeightFormat}}%</span>
      </div>
    </div>
    <!-- Настройка размера -->
    <div class="tool-button__items">
      <div class="tool-button container">Общая высота ландшафта:</div>
      <div class="tool-button container">
        <mat-slider class="long-slider"
                    thumbLabel
                    formControlName="worldLandHeight"
                    [thumbLabel]="false"
                    tickInterval="1000"
                    color="primary"
                    [step]="landStepZ"
                    [min]="landMinZ"
                    [max]="landMaxZ"
                    aria-label="blocks"
                    (input)="onLandHeightChange($event)"
                    (change)="onLandHeightChange($event)"></mat-slider>
      </div>
    </div>
  </form>
</ng-template>

<!-- Под-инструмент: тип местности -->
<ng-template #terrainTools>
  <!-- Текстура -->
  <div class="tool-button"
       *ngIf="getCurrentTool.type === toolType.terrain">
    <img [src]="getTerrainImage(currentTerrain)" />
    <!-- Список инструментов -->
    <div class="tool-button__items border-radius">
      <ng-container *ngFor="let terrain of terrainList">
        <div class="tool-button"
             [ngClass]="{ active: terrain.id === currentTerrain }"
             matTooltip="Материал: {{terrain.title}}"
             (click)="onTerrainChange(terrain.id)"
             *ngIf="terrain.isAvail">
          <img [src]="getTerrainImage(terrain.id)" />
        </div>
      </ng-container>
    </div>
  </div>
  <!-- Размер кисти -->
  <ng-container [ngTemplateOutlet]="toolsSizeForm"></ng-container>
</ng-template>

<!-- Под-инструмент: дорога -->
<ng-template #roadTools>
  <!-- Тип -->
  <div class="tool-button"
       *ngIf="getCurrentTool.type === toolType.road">
    <mat-icon>{{getCurrentRoadTypeTool.icon}}</mat-icon>
    <!-- Список инструментов -->
    <div class="tool-button__items border-radius">
      <ng-container *ngFor="let type of roadTypeList">
        <div class="tool-button"
             [ngClass]="{ active: type.type === roadType }"
             matTooltip="Тип дороги: {{type.name}}"
             (click)="onRoadTypeChange(type.type)">
          <mat-icon>{{type.icon}}</mat-icon>
        </div>
      </ng-container>
    </div>
  </div>
  <!-- Размер -->
  <div class="tool-button"
       *ngIf="this.getCurrentTool.type === toolType.road && this.roadType === roadTypeTool.road">
    <div class="tool-button__point "
         [ngStyle]="{
             'border-radius': 0,
             width: (toolSizeRoadFormat() * 3) + 'px',
             height: (toolSizeRoadFormat() * 3) + 'px'
           }"></div>
    <!-- Настройка размера -->
    <div class="tool-button__items">
      <div class="tool-button container">Ширина дороги:</div>
      <form class="tool-button container"
            [formGroup]="form">
        <mat-slider thumbLabel
                    formControlName="toolSizeRoad"
                    [displayWith]="toolSizeRoadFormat"
                    tickInterval="1000"
                    color="primary"
                    step="1"
                    min="0"
                    [max]="toolSizeRoadLength"
                    aria-label="blocks"
                    (input)="onToolSizeRoadChange($event)"
                    (change)="onToolSizeRoadChange($event)"></mat-slider>
      </form>
    </div>
  </div>
</ng-template>

<!-- Под-инструмент: вода -->
<ng-template #waterTools>
  <!-- Тип -->
  <div class="tool-button"
       *ngIf="getCurrentTool.type === toolType.water">
    <mat-icon>{{getCurrentWaterTypeTool.icon}}</mat-icon>
    <!-- Список инструментов -->
    <div class="tool-button__items border-radius">
      <ng-container *ngFor="let type of waterTypeList">
        <div class="tool-button"
             [ngClass]="{ active: type.type === waterType }"
             matTooltip="Тип дороги: {{type.name}}"
             (click)="onWaterTypeChange(type.type)">
          <mat-icon>{{type.icon}}</mat-icon>
        </div>
      </ng-container>
    </div>
  </div>
  <!-- Высота мирового океана -->
  <form class="tool-button"
        [formGroup]="form">
    <div class="tool-button__point progress">
      <div class="tool-button__point progress__height back">{{oceanHeightFormat}}%</div>
      <div class="tool-button__point progress__height fill"
           [ngStyle]="{ height: oceanHeightFormat + '%' }">
        <span>{{oceanHeightFormat}}%</span>
      </div>
    </div>
    <!-- Настройка размера -->
    <div class="tool-button__items">
      <div class="tool-button container">Высота мирового океана:</div>
      <div class="tool-button container">
        <mat-slider class="long-slider"
                    thumbLabel
                    formControlName="worldOceanHeight"
                    [thumbLabel]="false"
                    tickInterval="1000"
                    color="primary"
                    [step]="oceanStepZ"
                    [min]="oceanMinZ"
                    [max]="oceanMaxZ"
                    aria-label="blocks"
                    (input)="onOceanHeightChange($event)"
                    (change)="onOceanHeightChange($event)"></mat-slider>
      </div>
    </div>
  </form>
</ng-template>





<!-- Под-инструмент: размер кисти -->
<ng-template #toolsSizeForm>
  <form class="tool-button"
        [formGroup]="form">
    <div class="tool-button__point "
         [ngStyle]="toolSizeStyles"></div>
    <!-- Настройка размера -->
    <div class="tool-button__items">
      <div class="tool-button container">Размер кисти:</div>
      <div class="tool-button container">
        <mat-slider thumbLabel
                    formControlName="toolSizeLand"
                    [displayWith]="toolSizeLandFormat.bind(this)"
                    tickInterval="1000"
                    color="primary"
                    step="1"
                    min="0"
                    [max]="toolSizeLandLength"
                    aria-label="blocks"
                    (input)="onToolSizeLandChange($event)"
                    (change)="onToolSizeLandChange($event)"></mat-slider>
      </div>
    </div>
  </form>
</ng-template>
