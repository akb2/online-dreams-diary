<div id="mainMenuCollapsedHelperBefore"></div>

<!-- Шапка -->
<div class="main-menu {{ class }} type-{{ type }}"
     [style]="css.menu"
     (mousedown)="onScrollMouseDown($event)">

  <!-- Задний фон -->
  <div class="main-menu__layer back">
    <!-- Градиент -->
    <div class="main-menu__layer-gradient type-{{ type }}"
         *ngIf="!imageFullShow && type == 'full'">
      <app-main-background></app-main-background>
    </div>
    <!-- Картинка -->
    <div class="main-menu__layer-image type-{{ imageFullShow? 'short': type }} {{imageOverlay? 'overlay': ''}}"
         [style]="css.image"
         *ngIf="image.length && (type != 'full' || imageFullShow)">
      <img [src]="image"
           [style.object-position]="imagePositionY + ' ' + imagePositionX" />
    </div>
    <!-- Временная картинка -->
    <div class="main-menu__layer-image temp type-{{ imageFullShow? 'short': type }} {{tempImageOverlay? 'overlay': ''}}"
         [style]="css.image"
         *ngIf="tempImage.length && (type != 'full' || imageFullShow)">
      <img [src]="tempImage"
           [style.object-position]="tempImagePositionY + ' ' + tempImagePositionX" />
    </div>
    <div class="main-menu__layer-image type-full {{imageOverlay? 'overlay': ''}}"
         *ngIf="image && type == 'full' && !imageFullShow">
      <img [src]="image"
           [style.object-position]="imagePositionY + ' ' + imagePositionX" />
    </div>
    <!-- Заливка цветом -->
    <div class="main-menu__layer-fill"
         [style]="css.header"></div>
  </div>

  <!-- Средний фон -->
  <div class="main-menu__layer content">
    <!-- Все содержимое -->
    <div class="main-menu__layer-container container">
      <!-- Слой слева -->
      <div #contentLayerContainerLeft
           class="main-menu__layer-container_left {{backButtonLink? 'has-back-button': ''}}">
        <!-- Кнопка назад -->
        <div class="back-button"
             [style]="css.backButton"
             [routerLink]="backButtonLink"
             [queryParams]="backButtonLinkParams"
             *ngIf="backButtonLink"
             unselectable="on">
          <mat-icon>arrow_back_ios</mat-icon>
        </div>
        <!-- Вызов главного меню -->
        <div class="menu-button"
             [style]="css.backButton"
             *ngIf="isMobile() && !backButtonLink"
             (click)="toggleMobileMenu(1)"
             unselectable="on">
          <mat-icon>menu</mat-icon>
        </div>
        <!-- Аватарка -->
        <div class="main-menu__avatar"
             [style]="css.avatar"
             *ngIf="avatarImage || avatarIcon">
          <img [src]="avatarImage"
               *ngIf="avatarImage" />
          <mat-icon *ngIf="!avatarImage && avatarIcon">{{avatarIcon}}</mat-icon>
        </div>
        <!-- Заголовок -->
        <div class="main-menu__title"
             [style]="css.title"
             *ngIf="title">{{title}}</div>
        <!-- Подзаголовок -->
        <div class="main-menu__subtitle"
             [style]="css.subtitle"
             *ngIf="subTitle">{{subTitle}}</div>
      </div>
      <!-- Слой посередине -->
      <div class="main-menu__layer-container_center">
        <!-- Пункты главного меню -->
        <ng-container [ngTemplateOutlet]="mainMenu"
                      *ngIf="!isMobile()"></ng-container>
      </div>
      <!-- Слой справа -->
      <div class="main-menu__layer-container_right"
           *ngIf="floatButtonIcon && (floatButtonCallback || floatButtonLink)">
        <!-- Кнопка с ссылкой -->
        <a class="floating-button"
           [style]="css.floatingButton"
           [routerLink]="floatButtonLink"
           [queryParams]="floatButtonLinkParams"
           *ngIf="floatButtonLink">
          <div class="floating-button__overlay"
               [style]="css.floatingButtonOverlay"></div>
          <mat-icon>{{floatButtonIcon}}</mat-icon>
        </a>
        <!-- Кнопка без ссылки -->
        <button class="floating-button"
                [style]="css.floatingButton"
                *ngIf="!floatButtonLink"
                (click)="onFloatButtonClick()">
          <div class="floating-button__overlay"
               [style]="css.floatingButtonOverlay"></div>
          <mat-icon>{{floatButtonIcon}}</mat-icon>
        </button>
      </div>
      <!-- Ширина слоя -->
      <div #contentLayerContainer
           class="main-menu__layer-container_full"></div>
    </div>
    <!-- Кнопка вниз -->
    <a class="to-content-button"
       [style]="css.toContentButton"
       (click)="collapseMenu()"
       *ngIf="type=='full' && !hideToContentButton">
      <mat-icon>expand_more</mat-icon>
    </a>
  </div>

  <!-- Передний фон -->
  <div class="main-menu__layer front">
    <!-- Пункты главного меню -->
    <ng-container [ngTemplateOutlet]="mobileMenu"
                  *ngIf="isMobile()"></ng-container>
  </div>
</div>

<!-- Вспомогательный блок для коррекции контента -->
<div class="main-menu {{ class }} type-{{ type }} helper"
     [style]="css.helper"></div>
<div id="mainMenuCollapsedHelperAfter"></div>

<!-- Скролл страницы -->
<app-scroll [styles]="css.scroll"
            [breakpointMobile]="breakpointMobile"
            [headerHeight]="headerHeight"></app-scroll>



<!-- Главное меню -->
<ng-template #mainMenu>
  <nav>
    <ul class="menu-list"
        [style]="css.menuList">
      <li class="menu-list__item"
          *ngFor="let item of menuItems">
        <!-- Содержимое пункта меню -->
        <ng-container [ngTemplateOutlet]="mainMenuItem"
                      [ngTemplateOutletContext]="{ $implicit: item }"></ng-container>
        <!-- Список -->
        <div class="menu-list__item-list"
             *ngIf="item.children?.length">
          <ng-container [ngTemplateOutlet]="mainMenuItem"
                        [ngTemplateOutletContext]="{ $implicit: subItem }"
                        *ngFor="let subItem of item.children"></ng-container>
        </div>
      </li>
    </ul>
  </nav>
</ng-template>

<!-- Пункты главного меню -->
<ng-template #mainMenuItem
             let-item
             let-classes>
  <!-- Кнопка с ссылкой -->
  <a class="menu-list__item-link"
     [ngClass]="{ active: item.active }"
     [style]="css.menuItem"
     [routerLink]="item.link"
     *ngIf="!item.isSeparate && item.link && !item.callback">
    <ng-container [ngTemplateOutlet]="mainMenuItemContent"
                  [ngTemplateOutletContext]="{ $implicit: item }"></ng-container>
  </a>
  <!-- Кнопка без ссылки -->
  <button class="menu-list__item-link"
          [style]="css.menuItem"
          (click)="item.callback()"
          *ngIf="!item.isSeparate && !item.link && item.callback">
    <ng-container [ngTemplateOutlet]="mainMenuItemContent"
                  [ngTemplateOutletContext]="{ $implicit: item }"></ng-container>
  </button>
  <!-- Кнопка без действия -->
  <div class="menu-list__item-link"
       [style]="css.menuItem"
       *ngIf="!item.isSeparate && !item.link && !item.callback">
    <ng-container [ngTemplateOutlet]="mainMenuItemContent"
                  [ngTemplateOutletContext]="{ $implicit: item }"></ng-container>
  </div>
  <!-- Разделитель -->
  <div class="menu-list__item-separate"
       *ngIf="item.isSeparate">
  </div>
</ng-template>

<!-- Соджержимое пункта главного меню -->
<ng-template #mainMenuItemContent
             let-item>
  <span>{{item.text}}</span>
  <div class="menu-list__item-line"
       [style]="css.menuItemLine"></div>
</ng-template>



<!-- Мобильное меню -->
<ng-template #mobileMenu>
  <div class="mobile-menu {{showMobileMenu?'show':''}}"
       *ngIf="isMobile()">
    <div class="mobile-menu__overlay {{showMobileMenu?'show':''}}"
         (click)="toggleMobileMenu(-1)"></div>
    <div class="mobile-menu__layout {{showMobileMenu?'show':''}}">

      <!-- Информация о странице -->
      <div class="mobile-menu__info">
        <!-- Картинка -->
        <div class="mobile-menu__info-image type-{{ type }}"
             *ngIf="image">
          <img [src]="image" />
        </div>
        <!-- Закрытие меню -->
        <div class="mobile-menu__info-close"
             (click)="toggleMobileMenu(-1)"
             unselectable="on">
          <mat-icon>close</mat-icon>
        </div>
        <!-- Данные -->
        <div class="mobile-menu__info-content"
             [ngClass]="{ avatar: avatarImage || avatarIcon }">
          <!-- Аватарка -->
          <div class="mobile-menu__info-avatar"
               *ngIf="avatarImage || avatarIcon">
            <img [src]="avatarImage"
                 *ngIf="avatarImage" />
            <mat-icon *ngIf="!avatarImage && avatarIcon">{{avatarIcon}}</mat-icon>
          </div>
          <!-- Заголовок -->
          <div class="mobile-menu__info-title"
               *ngIf="title">{{title}}</div>
          <!-- Подзаголовок -->
          <div class="mobile-menu__info-subtitle"
               *ngIf="subTitle">{{subTitle}}</div>
        </div>
      </div>

      <!-- Пункты главного меню -->
      <nav class="mobile-menu__list">
        <ul>
          <li *ngFor="let item of menuItems">
            <ng-template [ngTemplateOutlet]="mobileMenuItem"
                         [ngTemplateOutletContext]="{ $implicit: item }"></ng-template>
            <!-- Список -->
            <div class="mobile-menu__list-list"
                 *ngIf="item.children?.length">
              <ng-container [ngTemplateOutlet]="mobileMenuItem"
                            [ngTemplateOutletContext]="{ $implicit: subItem }"
                            *ngFor="let subItem of item.children"></ng-container>
            </div>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</ng-template>

<!-- Пункты мобильного меню -->
<ng-template #mobileMenuItem
             let-item>
  <!-- Кнопка с ссылкой -->
  <a class="mobile-menu__list-link"
     [ngClass]="{ active: item.active }"
     [routerLink]="item.link"
     *ngIf="!item.isSeparate && item.link && !item.callback">
    <ng-container [ngTemplateOutlet]="mobileMenuItemContent"
                  [ngTemplateOutletContext]="{ $implicit: item }"></ng-container>
  </a>
  <!-- Кнопка без ссылки -->
  <button class="mobile-menu__list-link"
          (click)="item.callback()"
          *ngIf="!item.isSeparate && !item.link && item.callback">
    <ng-container [ngTemplateOutlet]="mobileMenuItemContent"
                  [ngTemplateOutletContext]="{ $implicit: item }"></ng-container>
  </button>
  <!-- Кнопка без действия -->
  <div class="mobile-menu__list-link"
       *ngIf="!item.isSeparate && !item.link && !item.callback">
  </div>
</ng-template>

<!-- Соджержимое пункта мобильного меню -->
<ng-template #mobileMenuItemContent
             let-item>
  <mat-icon>{{item.icon}}</mat-icon>
  <span>{{item.text}}</span>
</ng-template>